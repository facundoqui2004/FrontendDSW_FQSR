#!/bin/bash

echo "ğŸ§ª Test de Persistencia de SesiÃ³n - El SÃºper Gestor"
echo "================================================="
echo ""

echo "ğŸ” PASO 1: Verificando que el servidor estÃ© corriendo..."
if curl -s http://localhost:3000/health > /dev/null 2>&1; then
    echo "âœ… Servidor backend funcionando en puerto 3000"
else
    echo "âŒ ATENCIÃ“N: Servidor backend no responde en puerto 3000"
    echo "   AsegÃºrate de que el servidor backend estÃ© ejecutÃ¡ndose"
    echo ""
fi

echo ""
echo "ğŸ“‹ INSTRUCCIONES PARA PROBAR LA PERSISTENCIA:"
echo "=============================================="
echo ""
echo "1. ğŸŒ Abre http://localhost:5174 en tu navegador"
echo ""
echo "2. ğŸ”‘ Haz login con uno de estos usuarios:"
echo "   â€¢ admin123 / supersegura (Admin)"
echo "   â€¢ testuser / 123456 (Metahumano)"
echo "   â€¢ burocrata1 / tramite123 (BurÃ³crata)"
echo ""
echo "3. âœ… Verifica que el login funciona y te redirige al dashboard correcto"
echo ""
echo "4. ğŸ”„ RECARGA LA PÃGINA (F5 o Ctrl+R)"
echo ""
echo "5. ğŸ¯ RESULTADO ESPERADO:"
echo "   â€¢ La sesiÃ³n debe mantenerse"
echo "   â€¢ Debes seguir en tu dashboard (NO redirigido al login)"
echo "   â€¢ El botÃ³n debe mostrar 'Cerrar SesiÃ³n' en lugar de 'Login'"
echo ""
echo "6. ğŸšª Haz clic en 'Cerrar SesiÃ³n'"
echo ""
echo "7. ğŸ¯ RESULTADO ESPERADO:"
echo "   â€¢ Debe redirigirte a la pÃ¡gina principal (/)"
echo "   â€¢ El botÃ³n debe mostrar 'Login'"
echo "   â€¢ Si recargas, NO debe volver a loguearte automÃ¡ticamente"
echo ""
echo "8. ğŸ” Intenta acceder manualmente a rutas protegidas:"
echo "   â€¢ http://localhost:5174/homeAdmin"
echo "   â€¢ http://localhost:5174/homeMeta"
echo "   â€¢ http://localhost:5174/homeBurocrata"
echo ""
echo "9. ğŸ¯ RESULTADO ESPERADO:"
echo "   â€¢ Debe redirigirte automÃ¡ticamente a /login"
echo ""
echo "ğŸ’¡ FUNCIONALIDADES IMPLEMENTADAS:"
echo "================================="
echo "âœ… Persistencia de sesiÃ³n en localStorage"
echo "âœ… RecuperaciÃ³n automÃ¡tica al recargar pÃ¡gina"
echo "âœ… Logout completo (limpia localStorage)"
echo "âœ… Rutas protegidas con validaciÃ³n de roles"
echo "âœ… RedirecciÃ³n automÃ¡tica segÃºn estado de autenticaciÃ³n"
echo "âœ… Login en SidebarUser redirige a /login (no modal)"
echo "âœ… Logout funcional en todos los sidebars"
echo ""
echo "ğŸ› SI ALGO NO FUNCIONA:"
echo "======================="
echo "â€¢ Abre DevTools (F12) â†’ Console para ver logs detallados"
echo "â€¢ Verifica Application â†’ Local Storage para ver datos persistidos"
echo "â€¢ Comprueba que el servidor backend estÃ© funcionando"
echo ""
echo "ğŸ‰ Â¡La persistencia de sesiÃ³n estÃ¡ implementada!"
